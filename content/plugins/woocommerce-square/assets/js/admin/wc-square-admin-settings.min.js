"use strict";(function(){jQuery(document).ready(function(n){var a,c,e,s;if(null!=(e=window.typenow)?e:"","woocommerce_page_wc-settings"===(null!=(s=window.pagenow)?s:""))return n("#wc_square_system_of_record").change(function(){var e,s,t;return t=n(this).val(),s=(e=n("#wc_square_enable_inventory_sync")).closest("tr"),"square"===t||"woocommerce"===t?(e.next("span").html(wc_square_admin_settings.i18n.sync_inventory_label[t]),s.find(".description").html(wc_square_admin_settings.i18n.sync_inventory_description[t]),s.show()):s.hide(),"square"===t?n("#wc_square_hide_missing_products").closest("tr").show():n("#wc_square_hide_missing_products").closest("tr").hide()}).change(),n(".js-import-square-products").on("click",function(e){return e.preventDefault(),new n.WCBackboneModal.View({target:"wc-square-import-products"}),n("#btn-close").on("click",function(e){return e.preventDefault(),n("button.modal-close").trigger("click")}),n("#btn-ok").on("click",function(e){var s;return e.preventDefault(),n(this).unbind(),s={action:"wc_square_import_products_from_square",dispatch:wc_square_admin_settings.sync_in_background,security:wc_square_admin_settings.import_products_from_square},n.post(wc_square_admin_settings.ajax_url,s,function(e){var s;return s=e.data?e.data:null,e.success&&s?alert(s):!e.success&&s&&alert(s),location.reload()})})}),n("#wc-square-sync").on("click",function(e){return e.preventDefault(),new n.WCBackboneModal.View({target:"wc-square-sync"}),n("#btn-close").on("click",function(e){return e.preventDefault(),n("button.modal-close").trigger("click")}),n("#btn-ok").on("click",function(e){var s;return e.preventDefault(),n(this).unbind(),n("table.sync").block({message:null,overlayCSS:{opacity:"0.2"}}),n("table.records").block({message:null,overlayCSS:{opacity:"0.2"}}),n("#wc-square_clear-sync-records").prop("disabled",!0),s={action:"wc_square_sync_products_with_square",dispatch:wc_square_admin_settings.sync_in_background,security:wc_square_admin_settings.sync_products_with_square},n.post(wc_square_admin_settings.ajax_url,s,function(e){return e&&e.success?location.reload():(n("#wc-square_clear-sync-records").prop("disabled",!1),n("table.sync").unblock(),n("table.records").unblock(),console.log(e))})})}),c='<tr><td colspan="4"><em>'+wc_square_admin_settings.i18n.no_records_found+"</em></td></tr>",n("#wc-square_clear-sync-records").on("click",function(e){var s;return e.preventDefault(),n("table.records").block({message:null,overlayCSS:{opacity:"0.2"}}),s={action:"wc_square_handle_sync_records",id:"all",handle:"delete",security:wc_square_admin_settings.handle_sync_with_square_records},n.post(wc_square_admin_settings.ajax_url,s,function(e){return e&&e.success?(n("table.records tbody").html(c),n("#wc-square_clear-sync-records").prop("disabled",!0)):(e.data&&alert(e.data),console.log(e)),n("table.records").unblock()})}),n(".records .actions button.action").on("click",function(e){var t,s,r;return e.preventDefault(),n("table.records").block({message:null,overlayCSS:{opacity:"0.2"}}),r=n(this).data("id"),t=n(this).data("action"),s={action:"wc_square_handle_sync_records",id:r,handle:t,security:wc_square_admin_settings.handle_sync_with_square_records},n.post(wc_square_admin_settings.ajax_url,s,function(e){var s;return e&&e.success?(s="#record-"+r,"delete"===t?(n(s).remove(),n("table.records tbody tr").length||(n("table.records tbody").html(c),n("#wc-square_clear-sync-records").prop("disabled",!0))):"resolve"!==t&&"unsync"!==t||(n(s+" .type").html('<mark class="resolved"><span>'+wc_square_admin_settings.i18n.resolved+"</span></mark>"),n(s+" .actions").html("&mdash;"))):(e&&e.data&&alert(e.data),console.log({record:r,action:t,response:e})),n("table.records").unblock()})}),a=function(e){var r,s;return(r=n("span.progress"))&&0!==r.length||(n("p.sync-result").append(' <span class="progress" style="display:block"></span>'),r=n("span.progress")),s={action:"wc_square_get_sync_with_square_status",security:wc_square_admin_settings.get_sync_with_square_status_nonce,job_id:e},n.post(wc_square_admin_settings.ajax_url,s,function(e){var s,t;if(e&&e.data)return e.success&&e.data.id?(n("table.sync .spinner").css("visibility","visible"),n("#wc-square_clear-sync-records").prop("disabled",!0),n("table.records .actions button").prop("disabled",!0),"completed"!==(t=e.data.status)&&"failed"!==t?(s=" ","product_import"===e.data.action?(s+=wc_square_admin_settings.i18n.skipped+": "+parseInt(e.data.skipped_products_count,10)+"<br/>",s+=wc_square_admin_settings.i18n.imported+": "+parseInt(e.data.processed_products_count,10)):e.data.percentage&&(s+=parseInt(e.data.percentage,10)+"%"),r.html(s),setTimeout(function(){return a(e.data.id)},3e4)):location.reload()):(n("#wc-square_clear-sync-records").prop("disabled",!1),n("table.records .actions button").prop("disabled",!1),n("table.sync .spinner").css("visibility","hidden"),console.log(e))})},wc_square_admin_settings.existing_sync_job_id?a(wc_square_admin_settings.existing_sync_job_id):void 0})}).call(void 0);
//# sourceMappingURL=wc-square-admin-settings.min.js.map
